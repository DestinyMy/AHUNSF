{% load staticfiles %}   <!-- 虽然extends了 但还是要加上 -->
{% load collects_tags %}   <!-- 获取收藏数 -->

<div>
    <h2 align="center">{{product.name}}</h2>
          <ul>
              <li>{{product.publisher}}</li>
              <li>
              <a href={% url 'products_list_with_type' product.type.pk %}>
                  {{product.type}}
              </a></li>
              <li> {{product.pubTime | date:"Y-m-d H:i:s"}}</li>
              <li> {{product.last_updated_time | date:"Y-m-d H:i:s"}}</li>
          </ul>
</div>

<h1>{{ product.price }}</h1>

<div>
{{product.description |safe}}
</div>

<span class="collect {{product | get_collect_status:user}}" onclick="collectChange(this, '{{product|get_content_type}}', {{product.pk}})">
<span class="collected-num">{{product | get_collect_count }}</span>
<span>收藏</span>
</span>

<style>
    span.collect{
    color: #337ab7;
    cursor: pointer;
}

span.collect.active{
    color:rgb(248, 129, 129);
}
</style>

<script src="{% static 'jquery-1.12.4/jquery-1.12.4.min.js' %}"></script>

<script type="text/javascript">
  // 使用ajax动态点赞
  function collectChange(obj, content_type, object_id){
    var is_collect = obj.classList.contains('active') == false
    $.ajax({
      url: "{% url 'collect_change' %}",
      type: 'GET',
      data:{
        content_type: content_type,
        object_id: object_id,
        is_collect: is_collect
      },
      cache:false,
      success: function(data){
        console.log(data)
        if(data['status']=='SUCCESS'){
          //更新点赞状态
          $(obj).toggleClass("active")  //$()  由dom对象转为jQuery对象
          //更新点赞数量
          var collected_num = $(obj.getElementsByClassName('collected-num'));
          collected_num.text(data['collected_num'])
        }
        else{
          if(data['code']==400){//提醒登录
            $('#login_modal').modal('show')
          }
          else{

          }
        }
      },
      error: function(xhr){
        console.log(xhr)
      }
    });
  }
</script>

